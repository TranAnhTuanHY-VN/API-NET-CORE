-- Create and use database
DROP DATABASE IF EXISTS QLKHO
CREATE DATABASE QLKHO;
GO
USE QLKHO;
GO

-- Create table
DROP TABLE IF EXISTS NHACUNGCAP;
CREATE TABLE NHACUNGCAP(
	NCCID		UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	MaNCC		VARCHAR(36) NOT NULL UNIQUE,
	TenNCC		NVARCHAR(100) NOT NULL,
	DiaChi		NVARCHAR(100),
	SĐT			VARCHAR(50),
	Email		VARCHAR(50)
);

DROP TABLE IF EXISTS DANHMUC;
CREATE TABLE DANHMUC(
	DMID		UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	MaDM		VARCHAR(36) NOT NULL UNIQUE,
	TenDM		NVARCHAR(100) NOT NULL
);

DROP TABLE IF EXISTS HANG;
CREATE TABLE HANG(
	HID			UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	MaHang		VARCHAR(36) NOT NULL UNIQUE,
	DMID		UNIQUEIDENTIFIER NOT NULL,
	NCCID		UNIQUEIDENTIFIER NOT NULL,
	TenHang		NVARCHAR(100) NOT NULL,
	Mausac		NVARCHAR(50),
	SoLuong		int DEFAULT(0),
	DonGia		DECIMAL(18, 4),
	CONSTRAINT FK_HANG_DANHMUC FOREIGN KEY(DMID)
	REFERENCES DANHMUC(DMID) ON DELETE CASCADE,
	CONSTRAINT FK_HANG_NHACUNGCAP FOREIGN KEY(NCCID)
	REFERENCES NHACUNGCAP(NCCID) ON DELETE CASCADE
);

DROP TABLE IF EXISTS KHACHHANG;
CREATE TABLE KHACHHANG(
	KHID		UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	MaKH		VARCHAR(36) NOT NULL UNIQUE,
	TenKH		NVARCHAR(100) NOT NULL,
	DiaChi		NVARCHAR(100),
	SĐT			VARCHAR(50)
);

DROP TABLE IF EXISTS NHANVIEN;
CREATE TABLE NHANVIEN(
	NVID		UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	MaNV		VARCHAR(36) NOT NULL UNIQUE,
	TenNV		NVARCHAR(100) NOT NULL,
	DiaChi		NVARCHAR(100),
	ChucVu		NVARCHAR(50)
);

DROP TABLE IF EXISTS PHIEUNHAP;
CREATE TABLE PHIEUNHAP(
	NID			UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	MaPN		VARCHAR(36) NOT NULL UNIQUE,
	NgayNhap	Date,
	NVID		UNIQUEIDENTIFIER NOT NULL,
	SoLuongN	int,
	HID			UNIQUEIDENTIFIER NOT NULL,
	CONSTRAINT FK_PHIEUNHAP_NHANVIEN FOREIGN KEY(NVID)
	REFERENCES NHANVIEN(NVID) ON DELETE CASCADE,
	CONSTRAINT FK_PHIEUNHAP_HANG FOREIGN KEY(HID)
	REFERENCES HANG(HID) ON DELETE CASCADE
);

DROP TABLE IF EXISTS PHIEUXUAT;
CREATE TABLE PHIEUXUAT(
	XID			UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	MaPX		VARCHAR(36) NOT NULL UNIQUE,
	NgayXuat	Date,
	NVID		UNIQUEIDENTIFIER NOT NULL,
	SoLuongX	int,
	HID			UNIQUEIDENTIFIER NOT NULL,
	CONSTRAINT FK_PHIEUXUAT_NHANVIEN FOREIGN KEY(NVID)
	REFERENCES NHANVIEN(NVID) ON DELETE CASCADE,
	CONSTRAINT FK_PHIEUXUAT_HANG FOREIGN KEY(HID)
	REFERENCES HANG(HID) ON DELETE CASCADE
);

DROP TABLE IF EXISTS HOADON;
CREATE TABLE HOADON(
	DID			UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	SoHD		VARCHAR(36) NOT NULL UNIQUE,
	NgayTao		Date,
	NVID		UNIQUEIDENTIFIER NOT NULL,
	KHID		UNIQUEIDENTIFIER NOT NULL,
	SoLuong		int,
	DonGia		DECIMAL(18, 4),
	CONSTRAINT FK_HOADON_NHANVIEN FOREIGN KEY(NVID)
	REFERENCES NHANVIEN(NVID) ON DELETE CASCADE,
	CONSTRAINT FK_HOADON_KHACHHANG FOREIGN KEY(KHID)
	REFERENCES KHACHHANG(KHID) ON DELETE CASCADE
);

DROP TABLE IF EXISTS ACCOUNT;
CREATE TABLE ACCOUNT(
	AID			UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	NVID		UNIQUEIDENTIFIER not null,
	UserName	varchar(50) not null UNIQUE,
	Password	varchar(50) not null,
	Role		nvarchar(20) default 'admin',
	CONSTRAINT FK_ACCOUNT_NHANVIEN FOREIGN KEY(NVID)
		REFERENCES NHANVIEN(NVID) ON DELETE CASCADE
);

-- Insert data
INSERT INTO DANHMUC(MaDM, TenDM)
VALUES ('DM01', N'Sách'),
		('DM02', N'Báo'),
		('DM03', N'Đồ chơi'),
		('DM04', N'Đồ gia dụng');

INSERT INTO KHACHHANG(MaKH, TenKH, DiaChi, SĐT)
VALUES ('KH01', N'Đào Văn Lợi', N'Hưng Yên', '0968921148'),
		('KH02', N'Nguyễn Thị Hà', N'Thái bình', '0923912312'),
		('KH03', N'Hoàng Thiện Công', N'Bình phước', '0854293112'),
		('KH04', N'Hoàng Kim Lợi', N'Hà Nội', '0923846512');

INSERT INTO NHACUNGCAP(MaNCC, TenNCC, DiaChi, SĐT, Email)
VALUES ('NCC01', N'Công ty THNN Kim Chung', N'Hải Phòng', '0957432123', 'KC@gmail.com'),
		('NCC02', N'Công ty THNN Hà Mã', N'Hải Phòng', '0957432154', 'HM@gmail.com'),
		('NCC03', N'Công ty CNTT USOL', N'Hà Nội', '0958572123', 'usol@gmail.com'),
		('NCC04', N'Công ty THNN Bắc Kinh', N'Đắk Lắc', '0456332123', 'BK@gmail.com');

INSERT INTO NHANVIEN(MaNV, TenNV, DiaChi, ChucVu)
VALUES ('NV01', N'Nguyễn Hoàng Minh', N'Hải Phòng', N'Nhân viên'),
		('NV02', N'Trần Quốc Phi', N'Hải Phòng', N'Quản lý'),
		('NV03', N'Nguyễn Văn Song', N'Hà Nội', N'Nhân Viên'),
		('NV04', N'Phạm Nhật Tân', N'Đắk Lắc', N'Nhân Viên');

INSERT INTO HANG(MaHang, DMID, NCCID, TenHang, Mausac, SoLuong, DonGia)
VALUES ('H01', '4C414A89-1E23-4390-86F8-79C0281EB16D', '805CC5D7-7E67-4A55-A2CC-AD9E4B0E0AB6', N'Báo Mới', N'Trắng Đen', 50, 10000),
		('H02', '4C414A89-1E23-4390-86F8-79C0281EB16D', '87FD8B96-6641-4F99-9370-D5BE426274F3', N'Báo Nhân dân', N'Xám', 20, 2000),
		('H03', 'EAC14CFC-92BE-4A91-9096-6559087BC56C', '805CC5D7-7E67-4A55-A2CC-AD9E4B0E0AB6', N'Bộ Nồi Panasonic', N'Bạc', 2, 5000000),
		('H04', '9AA12751-0D7F-4CAE-984B-FF63B74E2F67', 'D7AFF026-A008-4B93-B773-BAD5FCABD779', N'Máy bay điều khiển', N'Vàng', 1, 1000000);

INSERT INTO HOADON(SoHD, NgayTao, NVID, KHID, SoLuong, DonGia)
VALUES ('HD01', '2001/05/18', 'B205EC7B-55EE-48D7-B6B6-B8AE40B371BD', 'A9BDA86E-92CE-4FD3-AF55-95DC870CEE76', 10, 100000),
		('HD02', '2012/05/12', 'F2625A38-C0F8-432B-ABE5-86CAEFFB6F33', '0FBC8A85-4309-4585-81E2-5F7B820A5E8B', 10, 20000),
		('HD03', '2002/12/12', 'E531E50A-B7F6-4ACF-9428-D17172680462', '36EE332A-6913-4D21-B359-EF5F8B5B1164', 2, 10000000),
		('HD04', '2004/05/06', 'F2625A38-C0F8-432B-ABE5-86CAEFFB6F33', 'BFED9DAC-A15E-4818-B916-BF7F5D1B7B87', 1, 1000000);

INSERT INTO PHIEUNHAP(MaPN, NgayNhap, NVID, SoLuongN, HID)
VALUES ('PN01', '2001/05/18', 'B205EC7B-55EE-48D7-B6B6-B8AE40B371BD', 10, 'D1C56B4A-5B6A-4CB3-ACF9-41649AED486D'),
		('PN02', '2012/05/12', 'F2625A38-C0F8-432B-ABE5-86CAEFFB6F33', 10, 'C7A62520-2C3B-4270-A88C-D1CEAF37B58F'),
		('PN03', '2002/12/12', 'E531E50A-B7F6-4ACF-9428-D17172680462', 2, '19D1304D-6A1F-4B4A-BA9A-AC95F2DD682A'),
		('PN04', '2004/05/06', 'F2625A38-C0F8-432B-ABE5-86CAEFFB6F33', 1, 'D1C56B4A-5B6A-4CB3-ACF9-41649AED486D');

INSERT INTO PHIEUXUAT(MaPX, NgayXuat, NVID, SoLuongX, HID)
VALUES ('PX01', '2001/05/18', 'B205EC7B-55EE-48D7-B6B6-B8AE40B371BD', 9, 'D1C56B4A-5B6A-4CB3-ACF9-41649AED486D'),
		('PX02', '2012/05/12', 'F2625A38-C0F8-432B-ABE5-86CAEFFB6F33', 1, 'C7A62520-2C3B-4270-A88C-D1CEAF37B58F'),
		('PX03', '2002/12/12', 'E531E50A-B7F6-4ACF-9428-D17172680462', 2, '19D1304D-6A1F-4B4A-BA9A-AC95F2DD682A'),
		('PX04', '2004/05/06', 'F2625A38-C0F8-432B-ABE5-86CAEFFB6F33', 1, 'D1C56B4A-5B6A-4CB3-ACF9-41649AED486D');

INSERT INTO ACCOUNT(NVID, UserName, Password)
VALUES ('B205EC7B-55EE-48D7-B6B6-B8AE40B371BD', 'loihy', '123456');